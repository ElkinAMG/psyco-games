function rand(e){return Math.floor(Math.random()*e)}function shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function changeBrightness(e,t){var n=document.createElement("canvas");n.width=500,n.height=500;var i=n.getContext("2d");i.drawImage(t,0,0,500,500);var a=i.getImageData(0,0,500,500);for(let t=0;t<a.data.length;t+=4)a.data[t]=a.data[t]*e,a.data[t+1]=a.data[t+1]*e,a.data[t+2]=a.data[t+2]*e;i.putImageData(a,0,0);var o=new Image;return o.src=n.toDataURL(),n.remove(),o}function displayVictoryMess(e){document.getElementById("moves").innerHTML="Hiciste "+e+" Movimientos.",toggleVisablity("Message-Container")}function toggleVisablity(e){"visible"==document.getElementById(e).style.visibility?document.getElementById(e).style.visibility="hidden":document.getElementById(e).style.visibility="visible"}function Maze(e,t){var n,i,a,o=e,r=t,s=["n","s","e","w"],l={n:{y:-1,x:0,o:"s"},s:{y:1,x:0,o:"n"},e:{y:0,x:1,o:"w"},w:{y:0,x:-1,o:"e"}};this.map=function(){return n},this.startCoord=function(){return i},this.endCoord=function(){return a},function(){for(n=new Array(r),y=0;y<r;y++)for(n[y]=new Array(o),x=0;x<o;++x)n[y][x]={n:!1,s:!1,e:!1,w:!1,visited:!1,priorPos:null}}(),function(){switch(rand(4)){case 0:i={x:0,y:0},a={x:r-1,y:o-1};break;case 1:i={x:0,y:o-1},a={x:r-1,y:0};break;case 2:i={x:r-1,y:0},a={x:0,y:o-1};break;case 3:i={x:r-1,y:o-1},a={x:0,y:0}}}(),function(){for(var e=!1,t=!1,i=1,a=0,c=0,d={x:0,y:0},y=o*r;!e;){for(t=!1,n[d.x][d.y].visited=!0,a>=c&&(shuffle(s),c=Math.round(rand(r/8)),a=0),a++,index=0;index<s.length;index++){var h=s[index],f=d.x+l[h].x,u=d.y+l[h].y;if(f>=0&&f<o&&u>=0&&u<r&&!n[f][u].visited){n[d.x][d.y][h]=!0,n[f][u][l[h].o]=!0,n[f][u].priorPos=d,d={x:f,y:u},i++,t=!0;break}}t||(d=n[d.x][d.y].priorPos),y==i&&(e=!0)}}()}function DrawMaze(e,t,n,i=null){var a,o,r=e.map(),s=n;function l(e,n,i){var a=e*s,o=n*s;0==i.n&&(t.beginPath(),t.moveTo(a,o),t.lineTo(a+s,o),t.stroke()),!1===i.s&&(t.beginPath(),t.moveTo(a,o+s),t.lineTo(a+s,o+s),t.stroke()),!1===i.e&&(t.beginPath(),t.moveTo(a+s,o),t.lineTo(a+s,o+s),t.stroke()),!1===i.w&&(t.beginPath(),t.moveTo(a,o),t.lineTo(a,o+s),t.stroke())}function c(){for(x=0;x<r.length;x++)for(y=0;y<r[x].length;y++)l(x,y,r[x][y])}t.lineWidth=s/40,this.redrawMaze=function(e){s=e,t.lineWidth=s/50,c(),a()},a=null!=i?function(){var n=s/50,a=s/25,o=e.endCoord();t.drawImage(i,2,2,i.width,i.height,o.x*s+n,o.y*s+n,s-a,s-a)}:function(){var n=e.endCoord(),i=s/4-2,a=!0;for(let e=0;e<4;e++){a=!a;for(let o=0;o<4;o++)t.beginPath(),t.rect(n.x*s+o*i+4.5,n.y*s+e*i+4.5,i,i),t.fillStyle=a?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.8)",t.fill(),a=!a}},o=s*r.length,t.clearRect(0,0,o,o),c(),a()}function Player(e,t,n,i,a=null){var o,r=t.getContext("2d"),s=0;o=function(t){r.beginPath(),r.fillStyle="yellow",r.arc((t.x+1)*y-h,(t.y+1)*y-h,h-2,0,2*Math.PI),r.fill(),t.x===e.endCoord().x&&t.y===e.endCoord().y&&(i(s),l.unbindKeyDown())},null!=a&&(o=f);var l=this,c=e.map(),d={x:e.startCoord().x,y:e.startCoord().y},y=n,h=y/2;function f(t){var n=y/50,o=y/25;r.drawImage(a,0,0,a.width,a.height,t.x*y+n,t.y*y+n,y-o,y-o),t.x===e.endCoord().x&&t.y===e.endCoord().y&&(i(s),l.unbindKeyDown())}function u(e){var t=y/50,n=y/25;r.clearRect(e.x*y+t,e.y*y+t,y-n,y-n)}function w(e){var t=c[d.x][d.y];switch(s++,e.keyCode){case 65:case 37:1==t.w&&(u(d),d={x:d.x-1,y:d.y},o(d));break;case 87:case 38:1==t.n&&(u(d),d={x:d.x,y:d.y-1},o(d));break;case 68:case 39:1==t.e&&(u(d),d={x:d.x+1,y:d.y},o(d));break;case 83:case 40:1==t.s&&(u(d),d={x:d.x,y:d.y+1},o(d))}}this.redrawPlayer=function(e){y=e,f(d)},this.bindKeyDown=function(){window.addEventListener("keydown",w,!1),$("#view").swipe({swipe:function(e,t,n,i,a,o){switch(console.log(t),t){case"up":w({keyCode:38});break;case"down":w({keyCode:40});break;case"left":w({keyCode:37});break;case"right":w({keyCode:39})}},threshold:0})},this.unbindKeyDown=function(){window.removeEventListener("keydown",w,!1),$("#view").swipe("destroy")},o(e.startCoord()),this.bindKeyDown()}var sprite,finishSprite,maze,draw,player,cellSize,difficulty,mazeCanvas=document.getElementById("mazeCanvas"),ctx=mazeCanvas.getContext("2d");function makeMaze(){null!=player&&(player.unbindKeyDown(),player=null);var e=document.getElementById("diffSelect");difficulty=e.options[e.selectedIndex].value,cellSize=mazeCanvas.width/difficulty,maze=new Maze(difficulty,difficulty),draw=new DrawMaze(maze,ctx,cellSize,finishSprite),player=new Player(maze,mazeCanvas,cellSize,displayVictoryMess,sprite),document.getElementById("mazeContainer").style.opacity<"100"&&(document.getElementById("mazeContainer").style.opacity="100")}window.onload=function(){let e=$("#view").width(),t=$("#view").height();t<e?(ctx.canvas.width=t-t/100,ctx.canvas.height=t-t/100):(ctx.canvas.width=e-e/100,ctx.canvas.height=e-e/100);var n=!1,i=!1,a=()=>{!0===n&&!0===i&&(console.log("Runs"),setTimeout((function(){makeMaze()}),500))};(sprite=new Image).src="assets/maze/key.png?"+(new Date).getTime(),sprite.setAttribute("crossOrigin"," "),sprite.onload=function(){sprite=changeBrightness(1.2,sprite),n=!0,console.log(n),a()},(finishSprite=new Image).src="./assets/maze/home.png?"+(new Date).getTime(),finishSprite.setAttribute("crossOrigin"," "),finishSprite.onload=function(){finishSprite=changeBrightness(1.1,finishSprite),i=!0,console.log(i),a()}},window.onresize=function(){let e=$("#view").width(),t=$("#view").height();t<e?(ctx.canvas.width=t-t/100,ctx.canvas.height=t-t/100):(ctx.canvas.width=e-e/100,ctx.canvas.height=e-e/100),cellSize=mazeCanvas.width/difficulty,null!=player&&(draw.redrawMaze(cellSize),player.redrawPlayer(cellSize))};